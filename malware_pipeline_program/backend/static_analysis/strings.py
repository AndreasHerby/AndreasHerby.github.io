from pathlib import Path

CHUNK_SIZE = 8192
PRINTABLE_MIN = 32   # space
PRINTABLE_MAX = 126  # ~

MIN_LENGTH = 4

SUSPICIOUS_KEYWORDS = [
    "EICAR", "http", "https", "cmd", "powershell",
    "kernel32", "user32", "wget", "curl", ".com",
]


def extract_strings(file_path: Path) -> dict:
    strings = []
    current = []

    with open(file_path, "rb") as f:
        while True:
            chunk = f.read(CHUNK_SIZE)
            if not chunk:
                break

            for byte in chunk:
                if PRINTABLE_MIN <= byte <= PRINTABLE_MAX:
                    current.append(chr(byte))
                else:
                    if len(current) >= MIN_LENGTH:
                        strings.append("".join(current))

                    current = []

    if len(current) >= MIN_LENGTH:
        strings.append("".join(current))

    suspicious_hits = [
        s for s in strings
        if any(keyword in s.lower() for keyword in SUSPICIOUS_KEYWORDS)
    ]

    return {
        "total_extracted": len(strings),
        "suspicious_hits": suspicious_hits[:10],
        "sample": strings[:10]
    }

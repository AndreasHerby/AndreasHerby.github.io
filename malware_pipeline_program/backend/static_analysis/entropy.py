import math
from pathlib import Path

CHUNK_SIZE = 8192


def calculate_entropy(file_path: Path) -> float:
    bytes_counts = [0] * 256
    total_bytes = 0

    with open(file_path, "rb") as f:
        while True:
            chunk = f.read(CHUNK_SIZE)
            if not chunk:
                break

            total_bytes += len(chunk)
            for byte in chunk:
                bytes_counts[byte] += 1

    if total_bytes == 0:
        return 0.0

    entropy = 0.0
    for count in bytes_counts:
        if count == 0:
            continue

        probability = count / total_bytes
        entropy -= probability * math.log2(probability)

    return entropy



